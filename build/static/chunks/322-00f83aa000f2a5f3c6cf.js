(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{94322:function(t,e,n){"use strict";var r=n(85893),a=n(809),i=n.n(a),o=n(92447),s=n(74047),c=n(52700),u=n(4706),l=n(8127),h=n(44102),p=n(20775),d=n(26265),f=n(79895),m=n(2014),g=n(282),Z=n(95477),y=n(43832),S=n(75834),b=n(41749),v=n(89659),x=n(52543),j=n(8286),w=n(22318),O=n(11163),C=n(67294),E=n(14494),R=n(66251),k=n(2060),N=n(86532),T=n(86395),V=n(91143),P=n(35404),U=n(34692),I=n(87547),z=n(68054),B=n(11195);function G(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,p.Z)(t);if(e){var a=(0,p.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,h.Z)(this,n)}}var _=function(t){(0,l.Z)(n,t);var e=G(n);function n(t){var r;return(0,s.Z)(this,n),r=e.call(this,t),(0,d.Z)((0,u.Z)(r),"validateForm",(function(){return""===r.state.phoneError})),(0,d.Z)((0,u.Z)(r),"handleChange",(function(t){var e;if("otp"===t.target.name){/^[0-9\b]+$/.test(t.target.value)&&6===t.target.value.length?r.setState({buttonState:!1}):r.setState({buttonState:!0})}if("phone"===t.target.name){/^[0-9\b]+$/.test(t.target.value)&&10===t.target.value.length?r.setState({submitButton:!1}):r.setState({submitButton:!0})}switch(r.setState((0,d.Z)({},t.target.name,t.target.value)),t.target.name){case"phone":e=/^[3-9]\d\d*$/.test(t.target.value),t.target.value||(r.setState({otp:"Otp cannot be empty"}),r.setState({buttonState:!0})),t.target.value||r.setState({phoneError:"Phone cannot be empty"}),10!==t.target.value.length||!e||function(t){for(var e=0,n=0;n<10;n++)new RegExp(n,"g").test(t)&&e++;return e}(t.target.value)<4?r.setState({phoneError:"Invalid mobile number !!"}):(r.setState({phoneError:""}),r.validateForm()?r.setState({submitButton:!1}):r.setState({buttonState:!0}))}})),(0,d.Z)((0,u.Z)(r),"setUpRecaptcha",(function(){window.recaptchaVerifier=new I.wC.auth.RecaptchaVerifier("recaptcha-container",{size:"invisible",callback:function(t){console.log("Captcha Resolved"),this.onSignInSubmit()},defaultCountry:"IN"})})),(0,d.Z)((0,u.Z)(r),"handleSubmit",(function(t){if(t.preventDefault(),r.setUpRecaptcha(),""!==r.state.phoneError)return!1;r.validateForm()&&(r.setState({phoneError:""}),r.handleSignUp((0,u.Z)(r)))})),(0,d.Z)((0,u.Z)(r),"handleSignUp",(0,o.Z)(i().mark((function t(){var e,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.setState({loading:!0}),r.setUpRecaptcha(),e="+91"+r.state.phone,console.log(e),n=window.recaptchaVerifier,console.log(n),I.wC.auth().signInWithPhoneNumber(e,n).then((function(t){window.confirmationResult=t,r.props.showSuccessSnackbar("OTP Sent","success"),r.setState({isOtpVisible:!0}),r.setState({loading:!1})})).catch((function(t){r.setState({loading:!1}),r.setState({isOtpVisible:!1}),r.props.showSuccessSnackbar("Please try again later","error")}));case 7:case"end":return t.stop()}}),t)})))),(0,d.Z)((0,u.Z)(r),"onSubmitOtp",(function(t){r.setState({loading:!0}),t.preventDefault();var e=r.state.otp,n=window.confirmationResult;console.log(n),n.confirm(e).then((function(t){console.log(t.user.uid);var e=t.user.uid.toString(),n={uid:e,custid:(0,z.OR)("PH"),email:"",fname:"Guest",lname:"Guest",address:"",admin:!1,role:"ROLE_USER",phone:r.state.phone,pic:"",pin:""};r.setState({loading:!1}),r.props.addUser(n,e),setTimeout((function(){r.props.clear()}),3e3),O.default.push("/")})).catch((function(t){r.props.showSuccessSnackbar("Try again later!","error"),r.setState({loading:!1})}))})),(0,d.Z)((0,u.Z)(r),"handleOtpChange",(function(t){return r.setState({otpValue:t})})),r.state={phone:"",phoneError:"",otp:"",isOtpVisible:!1,IsOtpError:!1,otpConfirmation:null,infoMessage:"",buttonState:!0,submitButton:!0,loading:!1},r}return(0,c.Z)(n,[{key:"render",value:function(){var t=this.props,e=t.classes;t.signupError,t.isAuthenticated,t.loading,C.Fragment;return this.state.isOtpVisible?(0,r.jsx)(y.Z,{component:"main",style:{justifyContent:"center"},children:(0,r.jsx)(b.Z,{container:!0,spacing:2,justify:"center",className:e.root,children:(0,r.jsx)(b.Z,{item:!0,xs:12,md:7,style:{borderRadius:2,margin:8,backgroundColor:R.Z.palette.primary.main},children:(0,r.jsx)(f.Z,{className:e.paper,elevation:2,children:(0,r.jsxs)("form",{className:e.form,onSubmit:this.handleSubmit,noValidate:!0,children:[(0,r.jsx)(m.Z,{style:{width:"90%",margin:"auto"},children:(0,r.jsx)(j.Z,{style:{width:"100%",margin:"auto",justifyContent:"center"},inputProps:{maxLength:6},required:!0,value:this.state.otp||"",name:"otp",label:"OTP",type:"phone",id:"otp",error:this.state.IsOtpError&&0!==this.state.IsOtpError,helperText:this.state.IsOtpError,onChange:this.handleChange})}),(0,r.jsx)("div",{className:e.buttonGroup,children:(0,r.jsxs)(g.Z,{size:"large",id:"sign-up-button",variant:"contained",color:"primary",className:e.custombutton,onClick:this.onSubmitOtp,disabled:this.state.buttonState,children:[(0,r.jsx)(w.Z,{variant:"h4",children:"CONFORM OTP"}),this.state.loading?(0,r.jsx)(Z.Z,{color:"secondary",size:40}):null]})})]})})})})}):(0,r.jsxs)(y.Z,{component:"main",style:{justifyContent:"center"},children:[(0,r.jsx)(S.ZP,{}),(0,r.jsxs)(b.Z,{container:!0,spacing:2,justify:"center",className:e.root,children:[(0,r.jsx)(S.ZP,{}),(0,r.jsx)(b.Z,{item:!0,xs:12,md:7,style:{borderRadius:2,margin:8,backgroundColor:R.Z.palette.primary.main},children:(0,r.jsxs)(f.Z,{className:e.paper,elevation:2,children:[(0,r.jsxs)(m.Z,{letterSpacing:2,children:[(0,r.jsx)(B.Z,{}),(0,r.jsx)(w.Z,{color:"secondary.dark",variant:"h3",gutterBottom:!0,align:"center",children:"Phone Registration"})]}),(0,r.jsxs)("form",{className:e.form,onSubmit:this.handleSubmit,noValidate:!0,children:[(0,r.jsx)("div",{id:"recaptcha-container"}),(0,r.jsx)(b.Z,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{style:{width:"100%",marginTop:10,marginRight:10},required:!0,value:this.state.phone||"",name:"phone",label:"Mobile number",type:"phone",id:"phone",error:this.state.phoneError&&0!==this.state.phoneError,helperText:this.state.phoneError,onChange:this.handleChange})}),(0,r.jsx)(m.Z,{component:"span",m:1,p:2}),(0,r.jsx)(m.Z,{display:"flex",style:{justifyContent:"center"},marginTop:4,children:(0,r.jsxs)(g.Z,{size:"large",id:"sign-up-button",variant:"contained",className:e.custombutton,onClick:this.handleSubmit,disabled:this.state.submitButton,children:[(0,r.jsx)(w.Z,{variant:"h4",children:"SIGN UP"}),this.state.loading?(0,r.jsx)(Z.Z,{color:"secondary",size:40}):null]})}),this.state.infoMessage,(0,r.jsx)(b.Z,{item:!0,xs:12,children:(0,r.jsx)("div",{display:"flex",justifyContent:"space-between",children:(0,r.jsx)(v.Z,{href:"/register",children:(0,r.jsxs)(w.Z,{variant:"h4",color:R.Z.palette.primary.main,children:[" ","Already registered?"]})})})})]})]})})]})]})}}]),n}(C.Component);e.Z=(0,E.$j)((function(t){return{signupError:t.auth.signupError,isAuthenticated:t.auth.isAuthenticated,auth:t.firebase.auth}}),(function(t){return{addUser:function(e,n){return t((0,P.cn)(e,n))},signUp:function(e){return t((0,N.y1)(e))},clear:function(){return t({type:k.wR})},serverStatus:function(){return t(T.HG)},showSuccessSnackbar:function(e,n){return t((0,V.Ev)(e,n))}}}))((0,x.Z)(U.Z,{withTheme:!0})((0,O.withRouter)(_)))},86395:function(t,e,n){"use strict";n.d(e,{yp:function(){return i},M3:function(){return o},zk:function(){return s},HG:function(){return c},kg:function(){return u}});var r=n(80447),a=n(2060),i=function(t,e,n){return function(i){r.Z.thaliOrder().postOrderStatus(t,e,n).then((function(t){i({type:a.sT,payload:t.data.updatedOrder})})).catch((function(t){console.log(t.response)}))}},o=function(t){return function(e){e({type:a.sT,payload:t})}},s=function(t,e){return function(n){n({type:a.Vy}),console.log(t),r.Z.thaliOrder().getThaliOrders(t,e).then((function(t){console.log(t),n({type:a._q,payload:t.data})})).catch((function(t){console.log(t),n({type:a.Vy})}))}},c=function(){return function(t){t({type:a.Vy}),r.Z.thaliOrder().home().then((function(e){t({type:a.pp})})).catch((function(e){t({type:a.Vy})}))}},u=function(t,e,n){return function(i){r.Z.thaliOrder().paymentStatus(t,e,n).then((function(t){i({type:a.sT,payload:t.data.updatedOrder})})).catch((function(t){console.log(t.response)}))}}}}]);