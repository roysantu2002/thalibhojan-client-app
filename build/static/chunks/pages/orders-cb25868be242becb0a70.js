(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[660],{12621:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return Y}});var t=n(85893),o=n(67294),i=n(26265),a=n(14494),c=n(41749),s=n(79895),l=n(22318),d=n(2014),u=n(24837),p=n(282),h=n(95477),f=n(41120),m=n(93837),x=n(32427),g=n(27484),y=n.n(g),j=n(84110),b=n.n(j),Z=n(64566),v=n(67708),O=n(50743),C=n(61201);function w(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}var k=(0,f.Z)((function(e){return function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?w(Object(n),!0).forEach((function(r){(0,i.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}({root:{width:"100%"},spaceTypo:{display:"flex",justifyContent:"space-between"},heading:{fontSize:e.typography.pxToRem(15),fontWeight:e.typography.fontWeightRegular}},e.spreadThis)}));function P(e){var r,n=k(),o=0,i=e.order,a=e.handlePayment;return"Orders"===e.condition&&(r=e.items).forEach((function(e){o+=e.quantity*e.price})),e.condition,(0,t.jsx)("div",{className:n.root,children:(0,t.jsxs)(v.Z,{children:[(0,t.jsxs)(O.Z,{expandIcon:(0,t.jsx)(Z.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",className:n.backgroundColorChange,children:[(0,t.jsx)(l.Z,{className:n.heading,children:"Orders"===e.condition&&"Order Summary"}),(0,t.jsx)(l.Z,{className:n.heading,children:"Payments"===e.condition&&"Capture Payment"})]}),(0,t.jsxs)(C.Z,{style:{display:"flex",flexDirection:"column"},children:["Orders"===e.condition&&(0,t.jsxs)(t.Fragment,{children:[r.map((function(e){return(0,t.jsxs)(l.Z,{variant:"body2",color:"textPrimary",children:[(0,t.jsxs)("div",{className:n.spaceTypo,children:[(0,t.jsx)("span",{children:e.title}),(0,t.jsxs)("span",{children:["\u20b9 ",e.price," x ",e.quantity]})]}),(0,t.jsx)("br",{})]},e._id)})),(0,t.jsxs)(l.Z,{variant:"h5",className:n.heading,children:["Total Amount - ",o]})]}),"Payments"===e.condition&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Z,{name:"received",onClick:function(e){return a(i,"received")},children:"Received"}),(0,t.jsx)(p.Z,{color:"secondary",onClick:function(e){return a(i,"not paid")},variant:"outlined",children:"Not Received"}),(0,t.jsx)(p.Z,{onClick:function(e){return a(i,"failed")},children:"Failed"})]})]})]})})}var N=n(86395);function S(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function E(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?S(Object(n),!0).forEach((function(r){(0,i.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var T=(0,x.Z)((function(e){return E(E({},e.spreadThis),{},{para:{fontSize:"x-large",marginLeft:"32%"},title:{margin:"20px 0px 10px 260px",display:"inline-block",marginRight:"40%"},spaceTypo:{display:"flex",justifyContent:"space-between"},address:{"& > *":{margin:e.spacing(4),width:"25ch"}},red:{color:"red"},green:{color:"green"},buttonCancel:{backgroundColor:"#cf0700",color:"white",marginBottom:20,marginTop:10,marginRight:10,marginLeft:10,"&:hover":{backgroundColor:"#5a5c5a"},"&:disabled":{backgroundColor:"#5a5c5a",color:"white"}},buttonAccept:{backgroundColor:"#118a27",color:"white",marginBottom:20,marginTop:10,marginRight:10,marginLeft:10,"&:hover":{backgroundColor:"#5a5c5a"}}})})),_=function(e){var r=e.order,n=e.role,o=e.auth,i=(e.clickedButtonHandler,T());y().extend(b());var c=(0,a.I0)(),d=function(){c((0,N.yp)(o.uid,r._id,{status:"Cancelled"}))};return(0,t.jsx)(s.Z,{style:{backgroundColor:"#faf7f7",marginTop:10,marginBottom:10,padding:10,margin:10},elevation:4,children:(0,t.jsxs)("div",{style:{marginLeft:20},children:[(0,t.jsxs)(l.Z,{gutterBottom:!0,variant:"h3",children:["OrderId - #",r.orderNumber]}),(0,t.jsx)(l.Z,{gutterBottom:!0,variant:"h4",children:"Ordered By - ".concat(r.user.customerId,", +91 ").concat(r.user.mobile)}),(0,t.jsx)("div",{style:{margin:"10px 20px 10px 0px"},children:(0,t.jsx)(P,{condition:"Orders",items:r.orderDetails})}),(0,t.jsxs)(l.Z,{gutterBottom:!0,variant:"body1",children:["Ordered - ",y()(r.createdAt).fromNow()]}),(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,t.jsx)(m.Z,{disabled:!0,className:"Cancelled"===r.status?i.red:i.green}),(0,t.jsxs)(l.Z,{gutterBottom:!0,children:["Order ",r.status]})]}),(0,t.jsxs)("div",{style:{margin:"auto",display:"flex",justifyContent:"center",justify:"center"},children:["ROLE_USER"===n&&"Placed"===r.status&&(0,t.jsx)(p.Z,{className:i.buttonCancel,onClick:d,disabled:"Placed"!==r.status,children:"Cancel Order"}),"ROLE_SELLER"===n&&"Placed"===r.status&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{style:{display:"inline-block"},children:["Cash"===r.pMethod&&(0,t.jsx)("div",{style:{margin:"10px 20px 10px 0px"},children:(0,t.jsx)(P,{condition:"Payments",order:r,handlePayment:function(e,r){console.log(e);var n={updatedBy:o.uid,customerId:e.user.customerId,orderNumber:e.orderNumber,orderStatus:e.status,status:r,paymentId:"Cash",paymentMethod:"Cash"};console.log(n),c((0,N.kg)(o.uid,e.orderNumber,n))}})}),(0,t.jsx)(p.Z,{className:i.buttonCancel,onClick:d,children:"Cancel"}),(0,t.jsx)(p.Z,{className:i.buttonAccept,onClick:function(){c((0,N.yp)(o.uid,r._id,{status:"Accepted"}))},children:"Accept"})]})}),"ROLE_SELLER"===n&&"Accepted"===r.status&&(0,t.jsx)(p.Z,{className:i.buttonAccept,onClick:function(){c((0,N.yp)(o.uid,r._id,{status:"Out For Delivery"}))},children:"Out For Delivery"}),"ROLE_SELLER"===n&&"Out For Delivery"===r.status&&(0,t.jsx)(p.Z,{className:i.buttonAccept,onClick:function(){c((0,N.yp)(o.uid,r._id,{status:"Completed"}))},children:"Order Completed"})]}),(0,t.jsx)("br",{})]})})},L=(n(80447),n(30381),n(11163)),R=n(8286),D=n(7397),B=n(14731),A=function(e){var r=e.searchKey,n=e.setSearchKey,o=e.children;e.classes;return(0,t.jsx)(c.Z,{item:!0,xs:12,children:(0,t.jsxs)(c.Z,{containe:!0,justify:"center",spacing:2,style:{padding:10,marginTop:10,marginBottom:10,display:"flex"},children:[(0,t.jsx)(R.Z,{placeholder:"Order...",inputProps:{maxLength:6},InputProps:{endAdornment:(0,t.jsx)(D.Z,{position:"end",children:(0,t.jsx)(B.Z,{})})},value:r,onChange:function(e){return n(e.target.value)}}),(0,t.jsx)(d.Z,{bgcolor:"secondary.main",color:"primary.main",p:.4,m:.5,children:o})]})})},I=n(35615),z=(n(23493),n(35996)),F="placed",K="accepted",H="cancelled",M="out for delivery",U=n(14578),V=(0,f.Z)((function(e){return{root:{flexGrow:1},paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary},spaceTypo:{padding:e.spacing(1),display:"flex",justifyContent:"space-between"}}})),q=function(e){var r=V(),n=e.orders;return(0,t.jsx)(c.Z,{item:!0,xs:12,children:(0,t.jsx)(c.Z,{container:!0,spacing:2,style:{padding:10,marginTop:10,marginBottom:10,display:"flex",justifyContent:"center",margin:"auto"},children:n&&n.length?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{item:!0,xs:12,md:6,children:(0,t.jsx)(s.Z,{className:r.paper,children:(0,t.jsxs)(l.Z,{component:"div",variant:"body1",children:[(0,t.jsxs)(d.Z,{bgcolor:"primary.main",p:2,border:2,children:[(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:["Today's Order"," "]}),(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:["[",n.length,"]"]})]}),(0,t.jsx)(d.Z,{p:1}),(0,t.jsxs)(d.Z,{bgcolor:"success.main",p:2,border:2,children:[(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:[F.toUpperCase()," "]}),(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:["[",function(){for(var e=0,r=0;r<n.length;r++)n[r].status.toString().toLowerCase()===F&&e++;return e}(),"]"]})]})]})})}),(0,t.jsx)(c.Z,{item:!0,xs:12,md:6,children:(0,t.jsx)(s.Z,{className:r.paper,children:(0,t.jsxs)(l.Z,{component:"div",variant:"body1",children:[(0,t.jsxs)(d.Z,{bgcolor:"primary.main",p:2,border:2,children:[(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:[K.toUpperCase()," "]}),(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:["[",function(){for(var e=0,r=0;r<n.length;r++)n[r].status.toString().toLowerCase()===K&&e++;return e}(),"]"]})]}),(0,t.jsx)(d.Z,{p:1}),(0,t.jsxs)(d.Z,{bgcolor:"error.main",p:2,border:2,children:[(0,t.jsx)(l.Z,{variant:"button",style:{color:"#ffffff"},children:H}),(0,t.jsxs)(l.Z,{variant:"h2",style:{color:"#ffffff"},children:["[",function(){for(var e=0,r=0;r<n.length;r++)n[r].status.toString().toLowerCase()===H&&e++;return e}(),"]"]})]})]})})}),(0,t.jsx)(c.Z,{item:!0,xs:12,md:7,children:(0,t.jsx)(s.Z,{className:r.paper,children:(0,t.jsxs)(l.Z,{component:"div",variant:"body1",children:[(0,t.jsx)(d.Z,{bgcolor:"primary.light",p:2,alignItems:"stretch",border:2,children:(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:[M.toUpperCase()," "]})}),(0,t.jsx)(d.Z,{bgcolor:"primary.main",p:2,alignItems:"stretch",border:2,children:(0,t.jsxs)(l.Z,{variant:"h2",color:"secondary.main",children:["[",function(){for(var e=0,r=0;r<n.length;r++)n[r].status.toString().toLowerCase()===M&&e++;return e}(),"]"]})})]})})})]}):(0,t.jsx)(c.Z,{item:!0,xs:12,md:6,children:(0,t.jsx)(s.Z,{className:r.paper,children:(0,t.jsx)(U.wYQ,{size:"50px",color:"primary"})})})})})};function G(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function W(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?G(Object(n),!0).forEach((function(r){(0,i.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var X=(0,f.Z)((function(e){return{root:W(W({},e.mixins.gutters()),{},{padding:e.spacing(3),marginBottom:e.spacing(5),display:"flex"}),paper:W(W({},e.mixins.gutters()),{},{marginTop:8,padding:2,margin:e.spacing(1),textAlign:"center",color:e.palette.text.secondary}),container:{height:"80px",padding:e.spacing(2),backgroundColor:e.palette.primary.main},title:{padding:e.spacing(.3)},button:{},activeButton:{backgroundColor:e.palette.primary.main},text:(0,i.Z)({color:"#ffffff",fontSize:"0.7rem"},e.breakpoints.down("md"),{color:e.palette.secondary.dark}),normalText:{fontSize:"0.8rem"},buttongroup:W(W({},e.mixins.gutters()),{},{margin:e.spacing(2),padding:e.spacing(2)}),spaceTypo:{padding:e.spacing(1),display:"flex",justifyContent:"space-between"}}})),Q=function(e){var r=X(),n=(0,a.v9)((function(e){return e.firebase.auth})),i=(0,a.v9)((function(e){return e.firebase.profile.role})),f=(0,a.v9)((function(e){return e.orderReducer.loading})),m=(0,a.v9)((function(e){return e.orderReducer.orders})),x=(0,o.useState)(""),g=x[0],j=x[1],Z=(0,L.useRouter)();y().extend(b());var v=(0,a.I0)(),O=(0,o.useState)("today"),C=O[0],w=O[1],k=(0,o.useState)(),P=k[0],S=k[1],E=(0,o.useState)(!1);E[0],E[1];(0,o.useEffect)((function(){console.log(g);var e=m;e=e.filter((function(e){return e.orderNumber.includes(g)})),S(e)}),[g]);var T=P&&P.length?P:m,R=function(e){w(e)};return console.log(C),(0,o.useEffect)((function(){""!==i&&v((0,N.zk)(n.uid,{filter:C}))}),[i,C,n.uid,v]),(0,o.useEffect)((function(){""!==i&&v((0,N.zk)(n.uid,{filter:"today"}));var e=(0,I.ZP)("http://localhost:5000");e.emit("add-user",{userId:n.uid}),e.on("orders",(function(r){console.log(r),e.on("orders",(function(e){"update"===e.action&&v((0,N.M3)(e.order)),"create"===e.action&&v((0,N.zk)(n.uid&&n.uid,{filter:"all"}))})),R("today")}))}),[]),console.log(m),console.log(P),n.uid?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(c.Z,{container:!0,spacing:2,justify:"center",className:r.root,children:(0,t.jsx)(c.Z,{item:!0,xs:12,children:(0,t.jsxs)(s.Z,{className:r.paper,elevation:2,children:[(0,t.jsx)(l.Z,{component:"div",variant:"body1",children:(0,t.jsx)(d.Z,{bgcolor:"primary.main",p:2,border:2,children:(0,t.jsx)(l.Z,{variant:"h2",color:"secondary.main",children:"Order History"})})}),(0,t.jsx)(c.Z,{item:!0,xs:12,children:(0,t.jsx)(u.Z,{size:"small",class:r.buttongroup,variant:"contained",color:"primary",children:["today","history"].map((function(e){return(0,t.jsx)(p.Z,{name:e,className:"".concat(C===e?r.activeButton:r.button),onClick:function(){return R(e)},children:C===e?(0,t.jsxs)(l.Z,{variant:"",className:r.title,children:[" ",e]}):(0,t.jsx)(l.Z,{variant:"",className:r.normalText,children:e})},e)}))})}),"ROLE_SELLER"===i?(0,t.jsx)(c.Z,{item:!0,container:!0,children:f?(0,t.jsx)(c.Z,{item:!0,xs:12,children:(0,t.jsx)(h.Z,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A,{searchKey:g,setSearchKey:j,classes:r.spaceTypo,children:(0,t.jsx)(z.default,{onClick:function(e){return j("")}})}),m&&m?(0,t.jsx)(q,{orders:m}):null,T&&T.map((function(e){return(0,t.jsx)(c.Z,{item:!0,xs:12,sm:4,children:(0,t.jsx)(_,{order:e,role:i,auth:n})},e._id)}))]})}):(0,t.jsxs)(c.Z,{item:!0,container:!0,direction:"row",children:[(0,t.jsx)(c.Z,{item:!0,xs:12,sm:1}),(0,t.jsx)(c.Z,{item:!0,xs:12,sm:10,children:(0,t.jsx)(c.Z,{container:!0,spacing:2,children:f?(0,t.jsx)(h.Z,{}):(0,t.jsxs)(c.Z,{container:!0,spacing:2,children:[(0,t.jsx)(A,{searchKey:g,setSearchKey:j,children:(0,t.jsx)(z.default,{onClick:function(e){return j("")}})}),T&&T.map((function(e){return(0,t.jsx)(c.Z,{item:!0,xs:12,sm:4,children:(0,t.jsx)(_,{order:e,role:i,auth:n,clickedButtonHandler:R})},e._id)}))]})})})]})]})})})}):Z.push("/signin")},Y=function(){return(0,t.jsx)(Q,{})}},86395:function(e,r,n){"use strict";n.d(r,{yp:function(){return i},M3:function(){return a},zk:function(){return c},HG:function(){return s},kg:function(){return l}});var t=n(80447),o=n(2060),i=function(e,r,n){return function(i){t.Z.thaliOrder().postOrderStatus(e,r,n).then((function(e){i({type:o.sT,payload:e.data.updatedOrder})})).catch((function(e){console.log(e.response)}))}},a=function(e){return function(r){r({type:o.sT,payload:e})}},c=function(e,r){return function(n){n({type:o.Vy}),console.log(e),t.Z.thaliOrder().getThaliOrders(e,r).then((function(e){console.log(e),n({type:o._q,payload:e.data})})).catch((function(e){console.log(e),n({type:o.Vy})}))}},s=function(){return function(e){e({type:o.Vy}),t.Z.thaliOrder().home().then((function(r){e({type:o.pp})})).catch((function(r){e({type:o.Vy})}))}},l=function(e,r,n){return function(i){t.Z.thaliOrder().paymentStatus(e,r,n).then((function(e){i({type:o.sT,payload:e.data.updatedOrder})})).catch((function(e){console.log(e.response)}))}}},65626:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/orders",function(){return n(12621)}])}},function(e){e.O(0,[876,128,764,75,774,888,179],(function(){return r=65626,e(e.s=r);var r}));var r=e.O();_N_E=r}]);