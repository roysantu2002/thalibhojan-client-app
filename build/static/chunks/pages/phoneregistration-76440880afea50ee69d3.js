(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[506],{29714:function(t,e,n){"use strict";n.r(e);var r=n(85893),o=n(809),i=n.n(o),a=n(92447),s=n(74047),c=n(52700),u=n(4706),l=n(8127),h=n(44102),p=n(20775),d=n(26265),f=n(79895),m=n(2014),g=n(282),y=n(43832),Z=n(75834),v=n(41749),x=n(89659),b=n(52543),w=n(8286),j=n(22318),S=n(11163),E=n(67294),O=n(14494),R=n(11195),C=n(66251),N=n(2060),P=n(86532),T=n(86395),k=n(91143),_=n(35404),V=n(34692),U=n(87547),I=n(68054);function H(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,p.Z)(t);if(e){var o=(0,p.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,h.Z)(this,n)}}var M=function(t){(0,l.Z)(n,t);var e=H(n);function n(t){var r;return(0,s.Z)(this,n),r=e.call(this,t),(0,d.Z)((0,u.Z)(r),"validateForm",(function(){return""===r.state.phoneError})),(0,d.Z)((0,u.Z)(r),"handleChange",(function(t){var e;switch(console.log(t.target.name),r.setState((0,d.Z)({},t.target.name,t.target.value)),t.target.name){case"phone":e=/^[3-9]\d\d*$/.test(t.target.value),t.target.value||r.setState({phoneError:"Phone cannot be empty"}),10!==t.target.value.length||!e||function(t){for(var e=0,n=0;n<10;n++)new RegExp(n,"g").test(t)&&e++;return e}(t.target.value)<4?r.setState({phoneError:"Invalid mobile number !!"}):r.setState({phoneError:""})}})),(0,d.Z)((0,u.Z)(r),"setUpRecaptcha",(function(){window.recaptchaVerifier=new U.wC.auth.RecaptchaVerifier("recaptcha-container",{size:"invisible",callback:function(t){console.log("Captcha Resolved")},defaultCountry:"IN"})})),(0,d.Z)((0,u.Z)(r),"handleSubmit",(function(t){if(t.preventDefault(),r.setUpRecaptcha(),""!==r.state.phoneError)return!1;r.validateForm()&&(r.setState({phoneError:""}),r.handleSignUp((0,u.Z)(r)))})),(0,d.Z)((0,u.Z)(r),"handleSignUp",(0,a.Z)(i().mark((function t(){var e,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.setUpRecaptcha(),e="+91"+r.state.phone,console.log(e),n=window.recaptchaVerifier,U.wC.auth().signInWithPhoneNumber(e,n).then((function(t){window.confirmationResult=t})).then((function(){r.setState({isOtpVisible:!0})})).catch((function(t){console.log(t)}));case 5:case"end":return t.stop()}}),t)})))),(0,d.Z)((0,u.Z)(r),"onSubmitOtp",(function(t){r.props.showSuccessSnackbar("Welcome"),t.preventDefault();var e=r.state.otp;window.confirmationResult.confirm(e).then((function(t){console.log(t.user.uid);var e=t.user.uid.toString(),n={uid:e,custid:(0,I.OR)("PH"),email:"",fname:"PH",lname:"PH",address:"",admin:!1,role:"ROLE_USER",phone:r.state.phone,pic:"",pin:""};console.log(n),r.props.addUser(n,e),setTimeout((function(){r.props.clear()}),3e3)})).catch((function(t){console.log(t)}))})),(0,d.Z)((0,u.Z)(r),"handleOtpChange",(function(t){return r.setState({otpValue:t})})),r.state={phone:"",phoneError:"",otp:"",isOtpVisible:!1,IsOtpError:!1,otpConfirmation:null,infoMessage:""},r}return(0,c.Z)(n,[{key:"render",value:function(){var t=this.props,e=t.classes;t.signupError,t.isAuthenticated,t.loading,E.Fragment;return(0,r.jsxs)(y.Z,{component:"main",style:{justifyContent:"center"},children:[(0,r.jsx)(Z.ZP,{}),(0,r.jsxs)(v.Z,{container:!0,spacing:2,justify:"center",className:e.root,children:[(0,r.jsx)(Z.ZP,{}),(0,r.jsx)(v.Z,{item:!0,xs:12,md:7,style:{borderRadius:2,margin:8,backgroundColor:C.Z.palette.primary.main},children:(0,r.jsxs)(f.Z,{className:e.paper,elevation:2,children:[(0,r.jsxs)(m.Z,{letterSpacing:2,children:[(0,r.jsx)(R.Z,{}),(0,r.jsx)(j.Z,{color:"primary",variant:"h3",gutterBottom:!0,align:"center",children:"Phone Registration"})]}),this.state.isOtpVisible?(0,r.jsx)("form",{className:e.form,onSubmit:this.handleSubmit,noValidate:!0,children:(0,r.jsxs)(v.Z,{item:!0,xs:12,children:[(0,r.jsx)(w.Z,{style:{width:"100%",marginTop:10,marginRight:10},required:!0,value:this.state.otp||"",name:"otp",label:"OTP",type:"phone",id:"otp",error:this.state.IsOtpError&&0!==this.state.IsOtpError,helperText:this.state.IsOtpError,onChange:this.handleChange}),(0,r.jsx)("div",{className:e.buttonGroup,children:(0,r.jsx)(g.Z,{id:"sign-up-button",variant:"contained",color:"primary",className:e.custombutton,onClick:this.onSubmitOtp,children:"CONFORM OTP"})})]})}):(0,r.jsxs)("form",{className:e.form,onSubmit:this.handleSubmit,noValidate:!0,children:[(0,r.jsx)("div",{id:"recaptcha-container"}),(0,r.jsx)(v.Z,{item:!0,xs:12,children:(0,r.jsx)(w.Z,{style:{width:"100%",marginTop:10,marginRight:10},required:!0,value:this.state.phone||"",name:"phone",label:"Mobile number",type:"phone",id:"phone",error:this.state.phoneError&&0!==this.state.phoneError,helperText:this.state.phoneError,onChange:this.handleChange})}),(0,r.jsx)(m.Z,{display:"flex",style:{justifyContent:"center"},marginTop:4,children:(0,r.jsx)(g.Z,{id:"sign-up-button",variant:"contained",color:"primary",className:e.custombutton,onClick:this.handleSubmit,children:"SIGN UP"})}),this.state.infoMessage]}),(0,r.jsx)(v.Z,{item:!0,xs:12,children:(0,r.jsx)("div",{display:"flex",justifyContent:"space-between",children:(0,r.jsx)(x.Z,{href:"/register",children:(0,r.jsxs)(j.Z,{variant:"h4",color:C.Z.palette.primary.main,children:[" ","Already registered?"]})})})})]})})]})]})}}]),n}(E.Component);e.default=(0,O.$j)((function(t){return{signupError:t.auth.signupError,isAuthenticated:t.auth.isAuthenticated,loading:t.ui.loading,auth:t.firebase.auth}}),(function(t){return{addUser:function(e,n){return t((0,_.cn)(e,n))},signUp:function(e){return t((0,P.y1)(e))},clear:function(){return t({type:N.wR})},serverStatus:function(){return t(T.HG)},showSuccessSnackbar:function(e){return t((0,k.Ev)(e))}}}))((0,b.Z)(V.Z,{withTheme:!0})((0,S.withRouter)(M)))},86395:function(t,e,n){"use strict";n.d(e,{yp:function(){return i},M3:function(){return a},zk:function(){return s},HG:function(){return c},kg:function(){return u}});var r=n(80447),o=n(2060),i=function(t,e,n){return function(i){r.Z.thaliOrder().postOrderStatus(t,e,n).then((function(t){i({type:o.sT,payload:t.data.updatedOrder})})).catch((function(t){console.log(t.response)}))}},a=function(t){return function(e){e({type:o.sT,payload:t})}},s=function(t,e){return function(n){n({type:o.Vy}),console.log(t),r.Z.thaliOrder().getThaliOrders(t,e).then((function(t){console.log(t),n({type:o._q,payload:t.data})})).catch((function(t){console.log(t),n({type:o.Vy})}))}},c=function(){return function(t){t({type:o.Vy}),r.Z.thaliOrder().home().then((function(e){t({type:o.pp})})).catch((function(e){t({type:o.Vy})}))}},u=function(t,e,n){return function(i){r.Z.thaliOrder().paymentStatus(t,e,n).then((function(t){i({type:o.sT,payload:t.data.updatedOrder})})).catch((function(t){console.log(t.response)}))}}},93173:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/phoneregistration",function(){return n(29714)}])},92447:function(t,e,n){"use strict";function r(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function s(t){r(a,o,i,s,c,"next",t)}function c(t){r(a,o,i,s,c,"throw",t)}s(void 0)}))}}n.d(e,{Z:function(){return o}})}},function(t){t.O(0,[774,888,179],(function(){return e=93173,t(t.s=e);var e}));var e=t.O();_N_E=e}]);